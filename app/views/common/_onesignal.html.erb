<script>
  var notifyButton = {
    enable: true,
    size: ['small', 'medium', 'large'][1],
    prenotify: true,
    showCredit: false,
    text: {
      'tip.state.unsubscribed':         "<%= t('onesignal.tip.state.unsubscribed') %>",
      'tip.state.subscribed':           "<%= t('onesignal.tip.state.subscribed') %>",
      'tip.state.blocked':              "<%= t('onesignal.tip.state.blocked') %>",
      'message.prenotify':              "<%= t('onesignal.message.prenotify') %>",
      'message.action.subscribed':      "<%= t('onesignal.message.action.subscribed') %>",
      'message.action.resubscribed':    "<%= t('onesignal.message.action.resubscribed') %>",
      'message.action.unsubscribed':    "<%= t('onesignal.message.action.unsubscribed') %>",
      'dialog.main.title':              "<%= t('onesignal.dialog.main.title') %>",
      'dialog.main.button.subscribe':   "<%= t('onesignal.dialog.main.button.subscribe') %>",
      'dialog.main.button.unsubscribe': "<%= t('onesignal.dialog.main.button.unsubscribe') %>",
      'dialog.blocked.title':           "<%= t('onesignal.dialog.blocked.title') %>",
      'dialog.blocked.message':         "<%= t('onesignal.dialog.blocked.message') %>"
    },
    displayPredicate: function () {
      return OneSignal.isPushNotificationsEnabled().then(function (isEnabled) {
        return <%= admin_signed_in? ? 'true' : '!isEnabled' %>
      })
    }
  };
  var welcomeNotification = {
    "title": "<%= t('onesignal.welcomeNotification.title') %>",
    "message": "<%= t('onesignal.welcomeNotification.message') %>"
  };
  var promptOptions = {
    siteName:                   "<%= t('onesignal.promptOptions.siteName').truncate(30) %>",
    actionMessage:              "<%= t('onesignal.promptOptions.actionMessage').truncate(90) %>",
    exampleNotificationTitle:   "<%= t('onesignal.promptOptions.exampleNotificationTitle') %>",
    exampleNotificationMessage: "<%= t('onesignal.promptOptions.exampleNotificationMessage') %>",
    exampleNotificationCaption: "<%= t('onesignal.promptOptions.exampleNotificationCaption').truncate(50) %>",
    acceptButtonText:           "<%= t('onesignal.promptOptions.acceptButtonText').truncate(15) %>",
    cancelButtonText:           "<%= t('onesignal.promptOptions.cancelButtonText').truncate(15) %>"
  };

</script>

<% if Rails.env.development? && user_signed_in? %>
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
  <script>
    var OneSignal = window.OneSignal || [];
    OneSignal.push(["init", {
      appId:               "<%= ENV['ONESIGNAL_APP_ID'] %>",
      autoRegister:        false,
      subdomainName:       'egotter-dev',
      notifyButton:        notifyButton,
      welcomeNotification: welcomeNotification,
      promptOptions:       promptOptions
    }]);
    OneSignal.push(["sendTag", "user_id", <%= current_user.id %>]);
  </script>
<% elsif Rails.env.production? && user_signed_in? %>
  <link rel="manifest" href="/manifest.json">
  <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
  <script>
    var OneSignal = window.OneSignal || [];
    OneSignal.push(["init", {
      appId:               "<%= ENV['ONESIGNAL_APP_ID'] %>",
      autoRegister:        false,
      notifyButton:        notifyButton,
      welcomeNotification: welcomeNotification,
      promptOptions:       promptOptions
    }]);
    OneSignal.push(["sendTag", "user_id", <%= current_user.id %>]);
  </script>
<% end %>
