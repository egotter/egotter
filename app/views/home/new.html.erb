<% right_side_options = {header: t('.right_side.header'), subheader: t('.right_side.subheader'), lead: t('.right_side.lead_html')} %>
<%= render partial: 'shared/side_by_side_section', locals: {right_side: right_side_options} %>

<%= render partial: 'adsense/responsive', locals: {controller: controller_name, action: action_name, vertical: :top} %>

<%= render partial: 'shared/review_section' %>
<%= render partial: 'shared/features_section' %>
<%= render partial: 'shared/functions_section' %>
<%= render partial: 'shared/announcements_section' %>

<% if show_redirection_modal? %>
  <% timeline_url = timeline_path(current_user, via: current_via('redirection_modal')) %>
  <% url = settings_path(via: current_via('redirection_modal')) %>
  <% url2 = sign_in_path(force_login: true, via: current_via('redirection_modal')) %>
  <% modal_body = t('.redirection_modal.body_html', user: current_user.screen_name, icon: current_user_icon, timeline_url: timeline_url, url: url, url2: url2) %>
  <%= render partial: 'modal/redirection_modal', locals: {title: t('.redirection_modal.title', user: current_user.screen_name), body: modal_body, url: timeline_path(current_user, via: current_via('redirection_modal'))} %>
<% end %>

<script>
  $(function () {
    trackPageEvents('TopPage events', 'Page loaded');

    var directionDetector = (function () {
      var prevScroll = 0;
      var direction;

      return function () {
        var curScroll = $(window).scrollTop();
        if (curScroll > prevScroll) {
          direction = 'down';
        } else {
          direction = 'up';
        }
        prevScroll = curScroll;
        return direction;
      }
    })();

    var timer = null;
    $(window).on('scroll', function () {
      if (timer === null) {
        trackPageEvents('TopPage events', 'Scroll ' + directionDetector() + ' started');
      } else {
        clearTimeout(timer);
      }

      timer = setTimeout(function () {
        trackPageEvents('TopPage events', 'Scroll ' + directionDetector() + ' stopped');
        timer = null;
      }, 500);
    })
  });
</script>
