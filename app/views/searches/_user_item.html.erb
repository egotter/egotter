<%
  user = user_item[:target]
  profile_image_url = user.profile_image_url_https.to_s
  mention_name = "@#{user.screen_name}"
  png = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC'
%>

<% unless uids.include?(user.uid.to_i) %>
  <%= render(partial: 'searches/profile_overview_modal',
             locals: {user: user, unique_id: user.uid, via: :profile_modal}) %>
  <script>
    $(function () {
      $('.profile-overview-modal.<%= user.uid %>').on('shown.bs.modal', function() {
        $.post('<%= modal_open_logs_path %>', {name: 'profile'});
      });
    });
  </script>
  <% uids << user.uid.to_i %>
<% end %>

<div class="user-item-carousel">
  <%# name box %>
  <div class="media name-box">
    <div class="media-left">
      <img class="lazy media-object" data-original="<%= profile_image_url %>" src="<%= png %>"
           alt="<%= mention_name %>" width="48" height="48">
    </div>

    <div class="media-body">
      <h4 class="media-heading"><%= user.name %>
        <% if user.protected %>&nbsp;<span class="glyphicon glyphicon-lock"></span><% end %>
        <% if user.verified %>&nbsp;<span class="glyphicon glyphicon-ok"></span><% end %>
      </h4>
      <span class="screen_name">
        <%= link_to mention_name, "https://twitter.com/#{user.screen_name}", target: '_blank' %>
      </span>
    </div>

    <div class="media-right">
      <% if user_signed_in? && user_item[:friendship] %>
        <span>
          <% if user_item[:me] %>
          <% elsif user_item[:friendship] %>
            <button type="button" class="btn btn-success with-margin-right">
              <span class="glyphicon glyphicon-ok"></span>
            </button>
          <% else %>
            <button type="button" class="btn btn-default with-margin-right">
              <span class="text-muted glyphicon glyphicon-plus"></span>
            </button>
          <% end %>
        </span>
      <% end %>

      <span>
        <button type="button" class="btn btn-info"
                data-toggle="modal" data-target=".profile-overview-modal.<%= user.uid %>">
          <span class="glyphicon glyphicon-search"></span>
        </button>
      </span>
    </div>
  </div><%# .media %>

  <%# description box %>
  <div class="media description-box" style="display: none;">
    <div class="media-left">
      <img class="lazy media-object" data-original="<%= profile_image_url %>" src="<%= png %>"
           alt="<%= mention_name %>" width="48" height="48">
    </div>

    <div class="media-body">
        <span class="description"><%= truncate(user.description, length: 20) %></span>
    </div>
  </div>

  <%# count box %>
  <div class="media count-box" style="display: none;">
    <div class="media-left">
      <img class="lazy media-object" data-original="<%= profile_image_url %>" src="<%= png %>"
           alt="<%= mention_name %>" width="48" height="48">
    </div>

    <div class="media-body">
      <div class="statuses_count"><%= user.statuses_count %>&nbsp;<%= t('dictionary.tweet') %></div>
      <span class="friends_count"><%= user.friends_count %>&nbsp;<%= t('dictionary.friends') %></span>
      <span class="followers_count"><%= user.followers_count %>&nbsp;<%= t('dictionary.follower') %></span>
    </div>
  </div>

  <%# score box %>
  <% if user.respond_to?(:score) %><%# close_friends score %>
    <div class="media score-box" style="display: none;">
      <div class="media-left">
        <img class="lazy media-object" data-original="<%= profile_image_url %>" src="<%= png %>"
             alt="<%= mention_name %>" width="48" height="48">
      </div>

      <div class="media-body">
        <div class="score">
          <%= t('dictionary.score') %>&nbsp;<%= "#{user.score} (#{user.replying_score.to_i}, #{user.replied_score.to_i}, #{user.favoriting_score.to_i})" %>
        </div>
      </div>
    </div>
  <% end %>
</div>
