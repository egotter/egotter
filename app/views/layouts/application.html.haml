!!!
%html{lang: 'ja'}
  %head
    %meta{content: 'text/html; charset=UTF-8', 'http-equiv' => 'Content-Type'}
    %meta{charset: 'utf-8'}
    %meta{content: 'IE=edge', 'http-equiv' => 'X-UA-Compatible'}
    %meta{content: 'width=device-width, initial-scale=1', name: 'viewport'}
    %link{rel: "icon", sizes: "192x192", href: image_path('/favicon-192.png')}
    %link{href: image_path('/apple-touch-icon.png'), rel: 'apple-touch-icon'}
    %link{href: image_path('/apple-touch-icon-120x120.png'), rel: 'apple-touch-icon', sizes: '120x120'}
    %link{href: image_path('/apple-touch-icon-152x152.png'), rel: 'apple-touch-icon', sizes: '152x152'}
    = render partial: 'common/meta_tags'
    %meta{content: 'summary_large_image', name: 'twitter:card'}
    %meta{content: '@ego_tter', name: 'twitter:site'}
    %link{href: '//maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css', rel: 'stylesheet'}
    %link{href: '//code.jquery.com/ui/1.12.0/themes/cupertino/jquery-ui.min.css', rel: 'stylesheet'}
    = stylesheet_link_tag 'application', media: 'all', crossorigin: 'anonymous'
    = javascript_include_tag 'application', crossorigin: 'anonymous'
    %script{src: '//code.jquery.com/ui/1.12.0/jquery-ui.js'}
    %script{src: '//cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js'}
    %script{src: '//maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js'}
    %link{crossorigin: "anonymous", href: "//use.fontawesome.com/releases/v5.6.3/css/all.css", integrity: "sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/", rel: "stylesheet"}
    = csrf_meta_tags

    = yield(:canonical_url) if content_for?(:canonical_url)

    = render partial: 'shared/google_analytics'

    %script{async: '', src: '//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'}
    :javascript
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-3146843071247817",
        enable_page_level_ads: true,
        overlays: {bottom: true}
      });

    - if user_signed_in?
      - if Rails.env.production?
        %link{href: '/manifest.json', rel: 'manifest'}
      %script{src: 'https://cdn.onesignal.com/sdks/OneSignalSDK.js'}
      :javascript
        #{render(partial: 'common/onesignal', formats: %i(js))}

    - if user_signed_in?
      :javascript
        Rollbar.configure({
          payload: {
            person: {
              id: #{current_user.id},
              username: "#{current_user.screen_name}",
              email: ""
            }
          }
        });

    :javascript
      window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function(f) {
          t._e.push(f);
        };

        return t;
      }(document, "script", "twitter-wjs"));

  %body
    = javascript_include_tag '/adsense.js'

    - unless show_simple_header?
      %nav.navbar.navbar-default
        .container
          .row
            .col-xs-12.header-container
              = render partial: 'layouts/header'

      #ajax-warning-message.container{style: 'display: none;'}
        .row
          .col-xs-12{style: 'background-color: #ffffff;'}
            .vertical-spacing
            %p.alert.alert-warning.alert-dismissable
              %a.close(href="#" data-dismiss="alert" aria-label="close") &times;

    .container
      .row
        .col-xs-12
          #global-warning-message-box{style: 'display: none;'}
            .vertical-spacing
            #global-warning-message.alert.alert-warning.alert-dismissible{role: "alert"}
              %button.close{"aria-label" => "Close", type: "button"}
                %span{"aria-hidden" => "true", onclick: "$('#global-warning-message-box').hide().find('.message').empty();"} &times;
              .message

    .container
      .row
        .col-xs-12
          #global-info-message-box{style: 'display: none;'}
            .vertical-spacing
            #global-info-message.alert.alert-info.alert-dismissible{role: "alert"}
              %button.close{"aria-label" => "Close", type: "button"}
                %span{"aria-hidden" => "true", onclick: "$('#global-info-message-box').hide().find('.message').empty();"} &times;
              .message

    - if notice || alert
      .container
        .row
          .col-xs-12
            - if alert
              .vertical-spacing
              #header-warning.alert.alert-warning.alert-dismissible{role: "alert"}
                %button.close{"aria-label" => "Close", "data-dismiss" => "alert", type: "button"}
                  %span{"aria-hidden" => "true"} &times;
                = raw alert
            - elsif notice
              .vertical-spacing
              #header-info.alert.alert-info.alert-dismissible{role: "alert"}
                %button.close{"aria-label" => "Close", "data-dismiss" => "alert", type: "button"}
                  %span{"aria-hidden" => "true"} &times;
                = raw notice

    - if wrap_in_container?
      %script{src: '//cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js', type: 'text/javascript', integrity: 'sha256-srhz/t0GOrmVGZryG24MVDyFDYZpvUH2+dnJ8FbpGi0=', crossorigin: 'anonymous'}
      %script{id: 'user-template', type: 'x-tmpl-mustache'}
        = search_link '{{screen_name}}', build_via('{{menu_name}}'), unescape: true, style: 'display: inline-block;' do
          %img.img-rounded{src: '{{profile_image_url_https}}', alt: '{{screen_name}}', width: 48, height: 48}

      .container{style: 'background-color: #ffffff;'}
        .row
          .col-xs-12{class: "#{'col-sm-12 col-md-9 col-lg-9' if show_sidebar?}"}
            = breadcrumbs style: :bootstrap, autoroot: false, link_current: true

            = yield
          - if show_sidebar?
            .hidden-xs.hidden-sm.col-md-3.col-lg-3.sidebar.text-center{style: 'padding-top: 15px;'}
              = render partial: 'layouts/sidebar', locals: {twitter_user: @twitter_user}
    - else
      = yield

    %script{src: '//cdnjs.cloudflare.com/ajax/libs/jquery.sticky/1.0.4/jquery.sticky.min.js', type: 'text/javascript'}
    %script{src: '//code.highcharts.com/7.0.2/highcharts.js', type: 'text/javascript'}
    %script{src: '//code.highcharts.com/7.0.2/highcharts-more.js', type: 'text/javascript'}
    %script{src: '//code.highcharts.com/7.0.2/modules/drilldown.js', type: 'text/javascript'}
    %script{src: '//code.highcharts.com/7.0.2/modules/solid-gauge.js', type: 'text/javascript'}
    %script{src: '//cdnjs.cloudflare.com/ajax/libs/d3/4.2.7/d3.min.js', type: 'text/javascript'}
    %script{src: '//cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.3/d3.layout.cloud.min.js', type: 'text/javascript'}
    %link{href: '//cdn.jsdelivr.net/jquery.jssocials/1.3.1/jssocials.css', rel: 'stylesheet', type: 'text/css'}
    %link{href: '//cdn.jsdelivr.net/jquery.jssocials/1.3.1/jssocials-theme-flat.css', rel: 'stylesheet', type: 'text/css'}
    %script{src: '//cdn.jsdelivr.net/jquery.jssocials/1.3.1/jssocials.min.js'}
    %script{src: 'https://js.stripe.com/v3'}
    = render partial: 'shared/stripe' if user_signed_in?

    = render partial: 'shared/feature_section', locals: {title: t('shared.sign_in_button_at_bottom.title_html'), image: '/egotter_useful_with_text_400x448.png', description: t('shared.sign_in_button_at_bottom.description_html'), note: nil, link: sign_in_with_twitter_link(nil, 'sign_in_button_at_bottom', class: 'btn btn-primary btn-block'), check: [t('shared.sign_in_button_at_bottom.check1'), t('shared.sign_in_button_at_bottom.check2'), t('shared.sign_in_button_at_bottom.check3')]} if show_sign_in_button_at_bottom?
    = render partial: 'shared/functions_section' if show_functions_section?
    = render partial: 'shared/announcement_section' if show_announcement_section?
    = render partial: 'layouts/footer' unless under_maintenance?

  - unless under_maintenance?
    #search-modal.modal.fade{'aria-labelledby' => 'search-modal-label', role: 'dialog', tabindex: '-1', data: {url: search_histories_path}}
      .modal-dialog.modal-lg{role: 'document'}
        .modal-content
          .modal-header
            %button.close{'aria-label' => 'Close', 'data-dismiss' => 'modal', type: 'button'}
              %span{'aria-hidden' => 'true'} ×
            %h4#search-modal-label.modal-title.text-center= t('searches.common.search_by_egotter')
          .modal-body
            = render partial: 'common/search_form', locals: {via: build_via('search_modal_input')}
            .text-muted.text-right{style: 'margin-top: 5px; max-width: 375px; margin: 0 auto;'}
              = t('search_histories.search_modal.remaining_count_is_html', count: SearchCountLimitation.remaining_search_count(user: current_user, session_id: fingerprint))
              %div
                - if user_signed_in?
                  - if current_user.has_valid_subscription?
                    = link_to current_user.purchased_plan_name, settings_path(via: build_via('plan_button_on_search_modal')), class: 'btn btn-default btn-sm'
                  - else
                    = t('search_histories.search_modal.purchase_html', url: pricing_path(via: build_via('purchase_button_on_search_modal')))
                - else
                  = t('search_histories.search_modal.sign_in_html', url: sign_in_path(via: build_via('sign_in_button_on_search_modal')))
                %a.btn.btn-default.btn-sm{data: {target: '#share-modal', toggle: 'modal'}}= t('search_histories.search_modal.tweet')
            - if SearchCountLimitation.remaining_search_count(user: current_user, session_id: fingerprint) == 0
              .vertical-spacing
              .alert.alert-info.text-left
                - sign_in_url = sign_in_path(via: build_via('too_many_searches_search_modal'))
                - pricing_url = pricing_path(via: build_via('too_many_searches_search_modal'))
                - support_url = pricing_path(via: build_via('too_many_searches_search_modal'), anchor: 'enterprise-plan')
                = search_count_limitation_too_many_searches_message(sign_in_url, pricing_url, support_url)
            %h2.text-center= t('search_histories.search_modal.title')
            .twitter.users.row

    :javascript
      $(function () {
        SearchHistories.initializeSearchModal();
      });


  - if user_signed_in?
    -# This modal will be initialized in Twitter.enableFollowButton('selector') after follow buttons are rendered.
    #create-follow-modal.modal.fade{role: 'dialog', tabindex: '-1'}
      .modal-dialog{role: 'document'}
        .modal-content
          .modal-body
            %p= t('twitter.create_follow_modal.message_html')
            %p= t('twitter.create_follow_modal.history_link_html', url: settings_path(via: build_via('create_follow_modal'), anchor: 'follow-count'))
            .dont-confirm
              %input#create-follow-dont-confirm{type: 'checkbox'}
              %label{for: 'create-follow-dont-confirm'}= t('twitter.create_follow_modal.dont_confirm')
          .modal-footer
            %button.btn.btn-default{"data-dismiss" => 'modal', type: 'button'}= t('twitter.create_follow_modal.cancel')
            %button.btn.btn-primary.ok{type: 'button', data: {url: follows_path(via: build_via('create_follow_modal'))}}= t('twitter.create_follow_modal.ok')

    -# This modal will be initialized in Twitter.enableUnfollowButton('selector') after unfollow buttons are rendered.
    #create-unfollow-modal.modal.fade{role: 'dialog', tabindex: '-1'}
      .modal-dialog{role: 'document'}
        .modal-content
          .modal-body
            %p= t('twitter.create_unfollow_modal.message_html')
            %p= t('twitter.create_unfollow_modal.history_link_html', url: settings_path(via: build_via('create_unfollow_modal'), anchor: 'unfollow-count'))
            .dont-confirm
              %input#create-unfollow-dont-confirm{type: 'checkbox'}
              %label{for: 'create-unfollow-dont-confirm'}= t('twitter.create_unfollow_modal.dont_confirm')
          .modal-footer
            %button.btn.btn-default{"data-dismiss" => 'modal', type: 'button'}= t('twitter.create_unfollow_modal.cancel')
            %button.btn.btn-danger.ok{type: 'button', data: {url: unfollows_path(via: build_via('create_unfollow_modal'))}}= t('twitter.create_unfollow_modal.ok')

    #follow-limitation-warning-modal.modal.fade{role: 'dialog', tabindex: '-1'}
      .modal-dialog{role: 'document'}
        .modal-content
          .modal-body
            %p= t('twitter.warning_follow_modal.message_html')
          .modal-footer
            = link_to t('twitter.warning_follow_modal.see_pricing'), pricing_path(via: build_via('follow_limit_warning')), class: 'btn btn-default', target: '_blank'
            - if user_signed_in?
              - if current_user.has_valid_subscription?
                %button.btn.btn-default{disabled: true}= t('twitter.warning_follow_modal.purchased')
              - else
                = link_to t('twitter.warning_follow_modal.purchase'), '#', class: 'btn btn-primary btn-checkout'
            - else
              = link_to t('twitter.warning_follow_modal.login'), sign_in_path(via: build_via('follow_limit_warning')), class: 'btn btn-primary'

    #unfollow-limitation-warning-modal.modal.fade{role: 'dialog', tabindex: '-1'}
      .modal-dialog{role: 'document'}
        .modal-content
          .modal-body
            %p= t('twitter.warning_unfollow_modal.message_html')
          .modal-footer
            = link_to t('twitter.warning_unfollow_modal.see_pricing'), pricing_path(via: build_via('unfollow_limit_warning')), class: 'btn btn-default', target: '_blank'
            - if user_signed_in?
              - if current_user.has_valid_subscription?
                %button.btn.btn-default{disabled: true}= t('twitter.warning_unfollow_modal.purchased')
              - else
                = link_to t('twitter.warning_unfollow_modal.purchase'), '#', class: 'btn btn-primary btn-checkout'
            - else
              = link_to t('twitter.warning_unfollow_modal.login'), sign_in_path(via: build_via('unfollow_limit_warning')), class: 'btn btn-primary'

  - if user_signed_in? && !under_maintenance?
    - if params[:follow_dialog] == '1'
      #follow-modal.modal.fade{role: 'dialog', tabindex: '-1'}
        .modal-dialog{role: 'document'}
          .modal-content
            .modal-header
              %button.close{"aria-label" => "Close", "data-dismiss" => "modal", type: 'button'}
                %span{"aria-hidden" => "true"} ×
              %h4.modal-title= t('welcome.follow_modal.title_html')
            .modal-body
              %img.center-block{src: image_path('/egotter_usagi_840x450.png'), height: request.from_pc? ? '200px' : '140px'}
              .vertical-spacing
              .vertical-spacing
              %p= t('welcome.follow_modal.note1_html')
            .modal-footer
              %button.btn.btn-default{"data-dismiss" => 'modal', type: 'button'}= t('welcome.follow_modal.cancel')
              %button.btn.btn-primary.ok{type: 'button', data: {url: follows_path(via: build_via('follow_egotter_modal')), uid: User::EGOTTER_UID, follow_url: follow_intent_url('ego_tter')}}= t('welcome.follow_modal.ok')

    -# This modal is always embedded because it is used in settings page.
    #share-modal.modal.fade{role: 'dialog', tabindex: '-1'}
      .modal-dialog{role: 'document'}
        .modal-content
          .modal-header
            %button.close{"aria-label" => "Close", "data-dismiss" => "modal", type: 'button'}
              %span{"aria-hidden" => "true"} ×
            %h4.modal-title= t('welcome.share_modal.title_html')
          .modal-body
            %img.center-block{src: image_path('/egotter_thanks_840x483.png'), height: request.from_pc? ? '200px' : '140px'}
            .vertical-spacing
            %p= t('welcome.share_modal.note1_html')
            .vertical-spacing
            %textarea{rows: '5', style: 'width: 100%; -webkit-appearance: none;'}= egotter_share_text(without_url: true)
            .share-text-note= t('welcome.share_modal.note_html')
            .share-text-note https://egotter.com #egotter
          .modal-footer
            %button.btn.btn-default{"data-dismiss" => 'modal', type: 'button'}= t('welcome.share_modal.cancel')
            %button.btn.btn-primary.ok{type: 'button', data: {url: shares_path(via: build_via('share_egotter_modal')), success_message: t('welcome.share_modal.success_message'), error_message: t('welcome.share_modal.error_message')}}= t('welcome.share_modal.ok')
