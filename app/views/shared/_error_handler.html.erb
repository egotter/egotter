<script>
  (function () {
    var userId = <%= current_user&.id %>;
    var eventAction = '<%= "#{controller_name}##{action_name}" %>';
    var deviceType = '<%= request.device_type %>';
    var os = '<%= request.os + ' ' + request.os_version %>';
    var browser = '<%= request.browser + ' ' + request.browser_version %>';

    var sendError = function (kind, message) {
      try {
        message = JSON.stringify({
          userId: userId,
          deviceType: deviceType,
          os: os,
          browser: browser,
          message: message
        });

        if (ga) {
          ga('send', {
            hitType: 'event',
            eventCategory: 'JS Exception (' + kind + ')',
            eventAction: eventAction,
            eventLabel: message
          });
          console.warn('Sent JS Exception to GA', kind, message);
        } else {
          console.warn('ga is not defined', kind, message);
        }
      } catch (e) {
        console.error(e);
      }
    };

    window.onerror = function (message, filePath, rowNumber, columnNumber) {
      sendError('onerror', 'message=' + message + '&filePath=' + filePath + '&rowNumber=' + rowNumber + '&columnNumber=' + columnNumber);
    };

    window.addEventListener('unhandledrejection', function (e) {
      sendError('unhandledrejection', e.message);
    });
  })();
</script>
