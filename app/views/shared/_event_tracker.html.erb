<%= javascript_pack_tag 'event_tracker' %>
<script>
  (function () {
    var eventTracker = new EventTracker({
      userId: '<%= current_user&.id %>',
      deviceType: '<%= request.device_type %>',
      controllerAction: '<%= controller_name %>#<%= action_name %>'
    });

    window.trackPageEvents = function (pageName, eventName, eventParams) {
      eventTracker.track(pageName, eventName, eventParams);
    };

    window.trackMessageEvent = function (eventName) {
      eventTracker.trackMessageEvent(eventName);
    };

    window.trackDetectionEvent = function (eventName) {
      eventTracker.trackDetectionEvent(eventName);
    };

    window.trackModalEvent = function (eventName) {
      eventTracker.trackModalEvent(eventName);
    };

    $(document).on('click', '.track-twitter-link', function () {
      var userId = '<%= current_user&.id %>';
      var deviceType = '<%= request.device_type %>';
      var eventName = 'See on Twitter';
      var controllerAction = '<%= "#{controller_name}##{action_name}" %>';
      var eventLocation = $(this).data('location');

      ga('send', {
        hitType: 'event',
        eventCategory: eventName,
        eventAction: controllerAction + ' / ' + eventLocation,
        eventLabel: JSON.stringify({userId: userId, deviceType: deviceType})
      });
      ahoy.track(eventName, {page: window.location.href, location: eventLocation});
    });
  })();
</script>
