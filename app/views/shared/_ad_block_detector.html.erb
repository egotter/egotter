<script>
  $(function () {
    var token = 'poinpgwawoiwoignsdoa';
    var isPremium = <%= user_signed_in? && current_user.has_valid_subscription? %>;
    var hasShareTweet = <%= user_signed_in? && current_user.sharing_count(5.minutes) > 0 %>;
    var message = '<%= t('before_sign_in.ad_blocker_detected_with_count', seconds: 3) %>';
    var redirectPath = "<%= root_path(user_token: current_user&.user_token, via: current_via('ad_blocker_detected')).html_safe %>";
    var isRootPage = <%= root_page? %>;

    if (isPremium || hasShareTweet) {
      return;
    }

    new AdBlockDetector(token).detect(function () {
      if (!isRootPage) {
        ToastMessage.warn(message);
        ToastMessage.freeze();

        setTimeout(function () {
          window.location.href = redirectPath;
        }, 3000);
      }

      trackDetectionEvent('AdBlocker detected');
    });
  });
</script>
