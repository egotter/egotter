<% user = current_user %>

<div class="menu">
  <h2><small><%= t('notifications.setting') %></small></h2>
  <h4><small><%= t('.notification.medium') %></small></h4>
  <%= render partial: 'misc/notification', collection: %i(email dm), cached: true, as: :name, locals: {setting: user.notification_setting} %>
  <h4><small><%= t('.notification.content') %></small></h4>
  <%= render partial: 'misc/notification', collection: %i(news search updated), cached: true, as: :name, locals: {setting: user.notification_setting} %>
  <script>
    function attach_event_handler(name) {
      var selector = 'input[name=' + name + ']';
      $(selector + ':checkbox').on('change', function () {
        var val = $(selector + ':checked').val() ? true : false;
        var params = {};
        params[name] = val;
        $.ajax({url: '<%= notification_path %>', method: 'PATCH', data: params})
            .done(function (res) {
              console.log(res);
              $('.blink.' + name).fadeIn(2000).fadeOut(2000);
            })
            .fail(function (xhr) {
              console.log(xhr.responseText);
            });
      });
    }

    $(function () {
      attach_event_handler('email');
      attach_event_handler('dm');
      attach_event_handler('news');
      attach_event_handler('search');
      attach_event_handler('updated');
    });
  </script>

  <%= render(partial: 'common/adsense') %>

  <div class="search-histories-menu">
    <h2><small><%= t('search_histories.index.title') %></small></h2>
  </div>
  <script>
    $(function () {
      var selector = '.search-histories-menu';
      var loadPath = '<%= search_histories_path %>';
      loadSearchHistories(selector, loadPath, false);
    });
  </script>
</div>
